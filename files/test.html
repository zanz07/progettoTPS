<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Simple Bullet Hell - Kaboom</title>
</head>
<body style="margin:0">

<script type="module">
import kaboom from "https://unpkg.com/kaboom/dist/kaboom.mjs";

// inizializza motore
kaboom({
    width: 800,
    height: 600,
    background: [0, 0, 20],
});

// crea un rettangolo come player (niente sprite)
function createPlayer() {
    return add([
        rect(20, 20),
        color(0, 255, 255),
        pos(center()),
        area(),
        outline(3),
        anchor("center"),
        "player"
    ]);
}

// crea un proiettile del player
function shootBullet(position) {
    add([
        pos(position),
        rect(4, 12),
        color(255, 255, 0),
        area(),
        offscreen({ destroy: true }),
        move(UP, 600),
        "playerBullet",
    ]);
}

// crea un nemico
function spawnEnemy() {
    const x = rand(50, width() - 50);
    const enemy = add([
        pos(x, -40),
        rect(26, 26),
        color(255, 50, 50),
        outline(2),
        area(),
        move(DOWN, 100),
        offscreen({ destroy: true }),
        "enemy",
    ]);

    // ogni nemico spara proiettili verso il basso
    wait(rand(0.5, 1.5), () => {
        if (!enemy.exists()) return;
        add([
            pos(enemy.pos.x, enemy.pos.y + 20),
            rect(6, 14),
            color(255, 150, 0),
            area(),
            move(DOWN, 300),
            offscreen({ destroy: true }),
            "enemyBullet"
        ]);
    });
}

// scena principale
scene("game", () => {
    const player = createPlayer();

    // input movimento
    const SPEED = 300;
    onKeyDown("left", () => player.move(-SPEED, 0));
    onKeyDown("right", () => player.move(SPEED, 0));
    onKeyDown("up", () => player.move(0, -SPEED));
    onKeyDown("down", () => player.move(0, SPEED));

    // sparo
    onKeyPress("space", () => shootBullet(player.pos));

    // spawn nemici continuo
    loop(0.8, () => spawnEnemy());

    // collisioni proiettile-player
    player.onCollide("enemyBullet", () => {
        shake(12);
        go("gameover");
    });

    // collisioni player vs nemici
    player.onCollide("enemy", () => {
        shake(12);
        go("gameover");
    });

    // collisioni proiettili del player vs nemici
    onCollide("playerBullet", "enemy", (bullet, enemy) => {
        destroy(bullet);
        destroy(enemy);
    });
});

// scena game over
scene("gameover", () => {
    add([
        text("GAME OVER\nPremi ENTER per ricominciare", { size: 28 }),
        pos(center()),
        anchor("center")
    ]);

    onKeyPress("enter", () => go("game"));
});

// avvio
go("game");

</script>

</body>
</html>
